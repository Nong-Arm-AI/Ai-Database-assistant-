# Chat Bot AI กับฐานข้อมูล

แอปพลิเคชัน Chat Bot AI ที่ใช้ OpenAI GPT-4o และเชื่อมต่อกับฐานข้อมูล MySQL ที่มีอยู่แล้ว เพื่อวิเคราะห์และตอบคำถามจากข้อมูลที่เก็บไว้

## คุณสมบัติ

- สนทนากับ AI ได้อย่างเป็นธรรมชาติ
- ค้นหาข้อมูลด้วยคำสั่ง SQL ที่สร้างจากคำถามภาษาธรรมชาติ
- ปรับแต่งคำแนะนำสำหรับ AI ในการวิเคราะห์ผลลัพธ์ SQL
- แสดงผลการวิเคราะห์แบบ real-time ทันทีที่ได้รับข้อมูล
- หน้าเว็บที่ใช้งานง่ายและสวยงาม

## การติดตั้ง

1. โคลนโปรเจกต์:
   ```
   git clone https://github.com/yourusername/ai-chatbot-db.git
   cd ai-chatbot-db
   ```

2. ติดตั้ง dependencies:
   ```
   pip install -r requirements.txt
   ```

3. สร้างไฟล์ `.env` ในโฟลเดอร์หลักของโปรเจกต์และกำหนดค่าต่อไปนี้:
   ```
   OPENAI_API_KEY=your_openai_api_key_here
   DB_HOST=localhost
   DB_PORT=3306
   DB_USER=root
   DB_PASSWORD=your_db_password
   DB_NAME=your_existing_database_name
   ```

## การใช้งาน

1. รันแอปพลิเคชัน:
   ```
   python main.py
   ```

2. เปิดเว็บเบราว์เซอร์และไปที่ `http://localhost:8000`

3. ใช้งานแอปพลิเคชันผ่านแท็บต่างๆ:
   - **แชท**: สนทนากับ AI
   - **ค้นหาด้วย SQL**: ใช้คำถามภาษาธรรมชาติเพื่อสร้างและรันคำสั่ง SQL
   - **ตั้งค่า**: ปรับแต่งคำแนะนำสำหรับ AI ในการวิเคราะห์ผลลัพธ์ SQL

## การตั้งค่าคำแนะนำสำหรับ AI

แอปพลิเคชันนี้อนุญาตให้คุณปรับแต่งคำแนะนำที่ส่งให้ AI ในการวิเคราะห์ผลลัพธ์ SQL:

1. คลิกที่แท็บ "ตั้งค่า"
2. แก้ไขคำแนะนำในกล่องข้อความ
3. คลิกปุ่ม "บันทึกคำแนะนำ" เพื่อบันทึกการเปลี่ยนแปลง
4. คลิกปุ่ม "คืนค่าเริ่มต้น" เพื่อกลับไปใช้คำแนะนำที่โหลดมาล่าสุด

คำแนะนำจะถูกบันทึกในไฟล์ `prompts.json` และจะถูกใช้ในการวิเคราะห์ผลลัพธ์ SQL ครั้งต่อไป

## API Endpoints

- `GET /`: หน้าเว็บหลัก
- `POST /chat`: สนทนากับ AI
- `POST /ai/sql-query`: สร้างและรันคำสั่ง SQL จากคำถามภาษาธรรมชาติ
- `GET /db/schema`: ดึงโครงสร้างฐานข้อมูล
- `POST /db/query`: รันคำสั่ง SQL โดยตรง
- `GET /debug/data`: ดึงข้อมูลดิบจากฐานข้อมูลเพื่อการตรวจสอบ
- `GET /api/prompt`: ดึงคำแนะนำสำหรับ AI
- `POST /api/prompt`: อัปเดตคำแนะนำสำหรับ AI

## ฟังก์ชันที่สำคัญ

- `generate_sql_from_question`: สร้างคำสั่ง SQL จากคำถามภาษาธรรมชาติ
- `analyze_sql_result`: วิเคราะห์ผลลัพธ์จากการรันคำสั่ง SQL
- `get_database_schema`: ดึงโครงสร้างฐานข้อมูล
- `execute_sql_query`: รันคำสั่ง SQL โดยตรง
- `save_prompts`: บันทึกคำแนะนำสำหรับ AI
- `load_prompts`: โหลดคำแนะนำสำหรับ AI

## ข้อกำหนดของฐานข้อมูล

แอปพลิเคชันนี้ต้องการเชื่อมต่อกับฐานข้อมูล MySQL ที่มีอยู่แล้ว โดยไม่มีการสร้างหรือแก้ไขโครงสร้างฐานข้อมูล AI จะเรียนรู้โครงสร้างฐานข้อมูลและดึงข้อมูลตามคำถามที่ได้รับ

## การแสดงผลแบบ Real-time

แอปพลิเคชันนี้สนับสนุนการแสดงผลการวิเคราะห์แบบ real-time โดยจะแสดงข้อความทันทีที่ได้รับจาก OpenAI API โดยไม่ต้องรอให้ครบก่อนค่อยแสดงผล ทำให้ผู้ใช้สามารถเห็นการวิเคราะห์ได้ทันทีและต่อเนื่อง

## การแก้ไขปัญหา

หากคุณพบปัญหาในการใช้งานแอปพลิเคชัน:

1. ตรวจสอบว่าคุณได้ตั้งค่า `.env` ถูกต้อง
2. ตรวจสอบว่าฐานข้อมูล MySQL ทำงานอยู่
3. ตรวจสอบว่าฐานข้อมูลที่ระบุมีอยู่จริงและมีข้อมูลอยู่
4. ตรวจสอบล็อกในคอนโซลเพื่อดูข้อผิดพลาด
5. ตรวจสอบว่าไฟล์ `prompts.json` สามารถเขียนได้ (หากมีปัญหาในการบันทึกคำแนะนำ)

## ลิขสิทธิ์

โปรเจกต์นี้อยู่ภายใต้ลิขสิทธิ์ MIT License 